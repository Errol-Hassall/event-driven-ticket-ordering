{
  "version": 3,
  "sources": ["../../../../../node_modules/@middy/core/index.js", "../../../../../services/functions/sendReceipt.ts"],
  "sourcesContent": ["import { EventEmitter } from 'events';\nconst defaultLambdaHandler = ()=>{};\nconst defaultPlugin = {\n    timeoutEarlyInMillis: 5,\n    timeoutEarlyResponse: ()=>{\n        throw new Error('Timeout');\n    }\n};\nconst middy = (lambdaHandler = defaultLambdaHandler, plugin = {})=>{\n    if (typeof lambdaHandler !== 'function') {\n        plugin = lambdaHandler;\n        lambdaHandler = defaultLambdaHandler;\n    }\n    plugin = {\n        ...defaultPlugin,\n        ...plugin\n    };\n    plugin.timeoutEarly = plugin.timeoutEarlyInMillis > 0;\n    plugin.beforePrefetch?.();\n    const beforeMiddlewares = [];\n    const afterMiddlewares = [];\n    const onErrorMiddlewares = [];\n    const middy1 = (event = {}, context = {})=>{\n        plugin.requestStart?.();\n        const request = {\n            event,\n            context,\n            response: undefined,\n            error: undefined,\n            internal: plugin.internal ?? {}\n        };\n        return runRequest(request, [\n            ...beforeMiddlewares\n        ], lambdaHandler, [\n            ...afterMiddlewares\n        ], [\n            ...onErrorMiddlewares\n        ], plugin);\n    };\n    middy1.use = (middlewares)=>{\n        if (!Array.isArray(middlewares)) {\n            middlewares = [\n                middlewares\n            ];\n        }\n        for (const middleware of middlewares){\n            const { before , after , onError  } = middleware;\n            if (!before && !after && !onError) {\n                throw new Error('Middleware must be an object containing at least one key among \"before\", \"after\", \"onError\"');\n            }\n            if (before) middy1.before(before);\n            if (after) middy1.after(after);\n            if (onError) middy1.onError(onError);\n        }\n        return middy1;\n    };\n    middy1.before = (beforeMiddleware)=>{\n        beforeMiddlewares.push(beforeMiddleware);\n        return middy1;\n    };\n    middy1.after = (afterMiddleware)=>{\n        afterMiddlewares.unshift(afterMiddleware);\n        return middy1;\n    };\n    middy1.onError = (onErrorMiddleware)=>{\n        onErrorMiddlewares.unshift(onErrorMiddleware);\n        return middy1;\n    };\n    middy1.handler = (replaceLambdaHandler)=>{\n        lambdaHandler = replaceLambdaHandler;\n        return middy1;\n    };\n    return middy1;\n};\nconst runRequest = async (request, beforeMiddlewares, lambdaHandler, afterMiddlewares, onErrorMiddlewares, plugin)=>{\n    const timeoutEarly = plugin.timeoutEarly && request.context.getRemainingTimeInMillis;\n    try {\n        await runMiddlewares(request, beforeMiddlewares, plugin);\n        if (request.response === undefined) {\n            plugin.beforeHandler?.();\n            const handlerAbort = new AbortController();\n            let timeoutAbort;\n            if (timeoutEarly) timeoutAbort = new AbortController();\n            request.response = await Promise.race([\n                lambdaHandler(request.event, request.context, {\n                    signal: handlerAbort.signal\n                }),\n                timeoutEarly ? setTimeoutPromise(request.context.getRemainingTimeInMillis() - plugin.timeoutEarlyInMillis, {\n                    signal: timeoutAbort.signal\n                }).then(()=>{\n                    handlerAbort.abort();\n                    return plugin.timeoutEarlyResponse();\n                }) : Promise.race([])\n            ]);\n            if (timeoutEarly) timeoutAbort.abort();\n            plugin.afterHandler?.();\n            await runMiddlewares(request, afterMiddlewares, plugin);\n        }\n    } catch (e) {\n        request.response = undefined;\n        request.error = e;\n        try {\n            await runMiddlewares(request, onErrorMiddlewares, plugin);\n        } catch (e) {\n            e.originalError = request.error;\n            request.error = e;\n            throw request.error;\n        }\n        if (request.response === undefined) throw request.error;\n    } finally{\n        await plugin.requestEnd?.(request);\n    }\n    return request.response;\n};\nconst runMiddlewares = async (request, middlewares, plugin)=>{\n    for (const nextMiddleware of middlewares){\n        plugin.beforeMiddleware?.(nextMiddleware.name);\n        const res = await nextMiddleware(request);\n        plugin.afterMiddleware?.(nextMiddleware.name);\n        if (res !== undefined) {\n            request.response = res;\n            return;\n        }\n    }\n};\nconst polyfillAbortController = ()=>{\n    if (process.version < 'v15.0.0') {\n        class AbortSignal {\n            toString() {\n                return '[object AbortSignal]';\n            }\n            get [Symbol.toStringTag]() {\n                return 'AbortSignal';\n            }\n            removeEventListener(name, handler) {\n                this.eventEmitter.removeListener(name, handler);\n            }\n            addEventListener(name, handler) {\n                this.eventEmitter.on(name, handler);\n            }\n            dispatchEvent(type) {\n                const event = {\n                    type,\n                    target: this\n                };\n                const handlerName = `on${type}`;\n                if (typeof this[handlerName] === 'function') this[handlerName](event);\n                this.eventEmitter.emit(type, event);\n            }\n            constructor(){\n                this.eventEmitter = new EventEmitter();\n                this.onabort = null;\n                this.aborted = false;\n            }\n        }\n        return class AbortController {\n            abort() {\n                if (this.signal.aborted) return;\n                this.signal.aborted = true;\n                this.signal.dispatchEvent('abort');\n            }\n            toString() {\n                return '[object AbortController]';\n            }\n            get [Symbol.toStringTag]() {\n                return 'AbortController';\n            }\n            constructor(){\n                this.signal = new AbortSignal();\n            }\n        };\n    } else {\n        return AbortController;\n    }\n};\nglobal.AbortController = polyfillAbortController();\nconst polyfillSetTimeoutPromise = ()=>{\n    return (ms, { signal  })=>{\n        if (signal.aborted) {\n            return Promise.reject(new Error('Aborted', 'AbortError'));\n        }\n        return new Promise((resolve, reject)=>{\n            const abortHandler = ()=>{\n                clearTimeout(timeout);\n                reject(new Error('Aborted', 'AbortError'));\n            };\n            const timeout = setTimeout(()=>{\n                resolve();\n                signal.removeEventListener('abort', abortHandler);\n            }, ms);\n            signal.addEventListener('abort', abortHandler);\n        });\n    };\n};\nconst setTimeoutPromise = polyfillSetTimeoutPromise();\nexport default middy;\n\n\n//# sourceMappingURL=index.js.map", "import middy from \"@middy/core\";\nimport { APIGatewayEvent, APIGatewayProxyResult, Context } from \"aws-lambda\";\n\nconst _sendReceipt = async (\n  event: APIGatewayEvent,\n  context: Context\n): Promise<APIGatewayProxyResult> => {\n  console.log(\"RECEIPT SENT\", event);\n\n  return {\n    statusCode: 202,\n    body: JSON.stringify({\n      completed: true,\n    }),\n  };\n};\n\nexport const handler = middy().handler(_sendReceipt);\n"],
  "mappings": "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",
  "names": []
}
